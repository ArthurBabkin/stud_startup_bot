# Миграция типа данных ID в базе данных

## Описание проблемы

Возникла ошибка `integer out of range` при попытке добавить пользователей с большими ID в таблицу users. 
Это происходит потому, что:

1. В нашей базе данных тип данных для `id` в таблице `users` был установлен как `INTEGER`, который может хранить значения от -2,147,483,648 до 2,147,483,647.
2. Telegram может назначать ID пользователей, превышающие этот диапазон (например, ID > 5,000,000,000).

## Решение

Мы изменили тип данных поля `id` в таблице `users` и соответствующих внешних ключей с `INTEGER` на `BIGINT`.

Тип `BIGINT` поддерживает значения от -9,223,372,036,854,775,808 до 9,223,372,036,854,775,807, что более чем достаточно для ID пользователей Telegram.

## Файлы, затронутые изменениями

1. `app/services/db_service.py` - изменены типы данных в функции создания таблиц (`init_db`).
2. `migrate_to_bigint.sql` - скрипт для миграции существующей базы данных.

## Как выполнить миграцию

### Локальная среда

1. Остановите сервер бота (если он запущен).
2. Выполните миграцию локальной базы данных:

```bash
psql -U studuser -d stud_startup -f migrate_to_bigint.sql
```

3. Запустите бот снова для проверки, что все работает корректно.

### Продакшн среда

1. Сначала протестируйте миграцию в тестовой среде!
2. Сделайте резервную копию базы данных:

```bash
docker exec stud_startup_pg pg_dump -U studuser -d stud_startup > stud_startup_backup.sql
```

3. Выполните миграцию:

```bash
docker cp migrate_to_bigint.sql stud_startup_pg:/tmp/
docker exec stud_startup_pg psql -U studuser -d stud_startup -f /tmp/migrate_to_bigint.sql
```

4. Перезапустите сервисы:

```bash
docker-compose down
docker-compose up -d
```

5. Проверьте логи на наличие ошибок:

```bash
docker logs stud_startup_bot
```

## Проверка

После миграции пользователи с большими ID смогут нормально использовать бота, и ошибка `integer out of range` не должна больше возникать. 